<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাকাউন্ট এবং ডাটা ডিলিট - EasyPremium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            deleteUser, 
            reauthenticateWithCredential, 
            EmailAuthProvider 
        } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            remove 
        } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBt9t6mcjUtXxX2igAJdseuIIc8pP_QPEw",
            authDomain: "easy-premium.firebaseapp.com",
            databaseURL: "https://easy-premium-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "easy-premium",
            storageBucket: "easy-premium.firebasestorage.app",
            messagingSenderId: "155891252265",
            appId: "1:155891252265:web:77ab41de24231e8e5ef038",
            measurementId: "G-CHL8K8HRPX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Global reference to current user
        let currentUser = null;

        // Listen for auth state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-email').textContent = user.email || 'অজানা ইমেইল';
                document.getElementById('not-logged-in').style.display = 'none';
                document.getElementById('logged-in-content').style.display = 'block';
            } else {
                currentUser = null;
                document.getElementById('not-logged-in').style.display = 'block';
                document.getElementById('logged-in-content').style.display = 'none';
            }
        });

        // Delete User Data only (keep account)
        async function deleteUserData() {
            if (!currentUser) {
                alert("আপনি লগইন করা নেই।");
                return;
            }

            if (!confirm("আপনি কি নিশ্চিত যে আপনার সকল ডাটা মুছে ফেলতে চান? এটি পুনরুদ্ধার করা যাবে না।")) {
                return;
            }

            try {
                const userRef = ref(db, 'users/' + currentUser.uid);
                await remove(userRef);
                alert("আপনার ডাটা সফলভাবে মুছে ফেলা হয়েছে।");
            } catch (error) {
                console.error("ডাটা ডিলিট ত্রুটি:", error);
                alert("ডাটা মুছে ফেলতে সমস্যা হয়েছে: " + error.message);
            }
        }

        // Delete Entire Account (auth + data)
        async function deleteAccount() {
            if (!currentUser) {
                alert("আপনি লগইন করা নেই।");
                return;
            }

            const password = prompt("অ্যাকাউন্ট ডিলিট নিশ্চিত করতে আপনার পাসওয়ার্ড দিন:");
            if (!password) return;

            try {
                // Re-authenticate (required for sensitive operations)
                const credential = EmailAuthProvider.credential(currentUser.email, password);
                await reauthenticateWithCredential(currentUser, credential);

                // Delete data first
                const userRef = ref(db, 'users/' + currentUser.uid);
                await remove(userRef);

                // Then delete user from Auth
                await deleteUser(currentUser);

                alert("আপনার অ্যাকাউন্ট এবং সকল ডাটা সফলভাবে মুছে ফেলা হয়েছে।");
                // Optional: redirect to home or login
                window.location.href = "index.html";
            } catch (error) {
                console.error("অ্যাকাউন্ট ডিলিট ত্রুটি:", error);
                if (error.code === 'auth/wrong-password') {
                    alert("ভুল পাসওয়ার্ড। আবার চেষ্টা করুন।");
                } else if (error.code === 'auth/requires-recent-login') {
                    alert("সিকিউরিটির জন্য আবার লগইন করুন এবং চেষ্টা করুন।");
                } else {
                    alert("অ্যাকাউন্ট ডিলিট করতে সমস্যা: " + error.message);
                }
            }
        }

        // Make functions available globally
        window.deleteUserData = deleteUserData;
        window.deleteAccount = deleteAccount;
    </script>

    <style>
        /* আপনার privacy.html থেকে নেয়া একই স্টাইল */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI','Noto Sans Bengali',sans-serif; }
        body { background:#f8fafc; color:#333; line-height:1.7; min-height:100vh; }
        .header { background:linear-gradient(135deg,#1e3a8a 0%,#2563eb 100%); padding:18px 40px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 12px rgba(30,58,138,0.15); position:sticky; top:0; z-index:1000; width:100%; }
        .logo-container { display:flex; align-items:center; gap:12px; }
        .logo-icon { font-size:1.8rem; color:#fff; background:rgba(255,255,255,0.15); width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; }
        .logo-text { font-size:1.5rem; font-weight:700; color:#fff; }
        .logo-text span { color:#fbbf24; }
        .back-btn { background:rgba(255,255,255,0.15); color:white; text-decoration:none; font-weight:600; padding:12px 24px; border-radius:8px; display:flex; align-items:center; gap:10px; transition:all 0.3s; }
        .back-btn:hover { background:rgba(255,255,255,0.25); transform:translateY(-2px); }
        .main-container { width:100%; max-width:1400px; margin:40px auto; padding:0 40px; }
        .hero-section { background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%); border-radius:20px; padding:60px 40px; color:white; text-align:center; margin-bottom:50px; box-shadow:0 10px 30px rgba(59,130,246,0.2); width:100%; }
        .hero-icon { font-size:5rem; margin-bottom:25px; color:#fbbf24; }
        .hero-title { font-size:3.2rem; margin-bottom:20px; font-weight:700; }
        .hero-subtitle { font-size:1.3rem; opacity:0.9; max-width:900px; margin:0 auto; }
        .section-card { background:white; border-radius:18px; padding:45px; box-shadow:0 8px 25px rgba(0,0,0,0.08); border:1px solid #e5e7eb; margin-bottom:40px; }
        .section-header { display:flex; align-items:center; gap:20px; margin-bottom:30px; padding-bottom:20px; border-bottom:2px solid #e5e7eb; }
        .section-icon { background:#3b82f6; color:white; width:60px; height:60px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:1.8rem; }
        .section-title { font-size:2rem; color:#1e3a8a; font-weight:700; }
        .warning-box { background:linear-gradient(135deg,#fee2e2 0%,#fecaca 100%); border-radius:15px; padding:35px; margin:25px 0; border-left:6px solid #dc2626; text-align:center; }
        .delete-btn { background:#dc2626; color:white; border:none; padding:15px 40px; font-size:1.2rem; font-weight:600; border-radius:8px; cursor:pointer; transition:all 0.3s; }
        .delete-btn:hover { background:#b91c1c; transform:translateY(-2px); }
        .info-text { font-size:1.1rem; color:#4b5563; margin:15px 0; }
        #not-logged-in, #logged-in-content { display:none; }
        @media (max-width:768px) {
            .header { padding:12px 15px; }
            .hero-section { padding:30px 20px; }
            .hero-title { font-size:1.8rem; }
            .section-card { padding:25px; }
            .section-title { font-size:1.5rem; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="logo-container">
            <div class="logo-icon"><i class="fas fa-shield-alt"></i></div>
            <div class="logo-text">Easy<span>Premium</span></div>
        </div>
        <a href="index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> ফিরে যান
        </a>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <section class="hero-section">
            <i class="fas fa-user-shield hero-icon"></i>
            <h1 class="hero-title">ডাটা এবং অ্যাকাউন্ট ডিলিট</h1>
            <p class="hero-subtitle">আপনার প্রাইভেসি আমাদের কাছে গুরুত্বপূর্ণ। নিচে আপনি নিজের ডাটা বা সম্পূর্ণ অ্যাকাউন্ট মুছে ফেলতে পারবেন।</p>
        </section>

        <div id="not-logged-in" style="text-align:center; padding:60px 20px; background:white; border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.1);">
            <h2 style="color:#dc2626; margin-bottom:20px;">আপনি লগইন করা নেই</h2>
            <p style="font-size:1.2rem; color:#4b5563;">ডাটা বা অ্যাকাউন্ট ডিলিট করতে হলে আগে লগইন করুন।</p>
            <a href="login.html" style="display:inline-block; margin-top:20px; padding:12px 30px; background:#3b82f6; color:white; text-decoration:none; border-radius:8px; font-weight:600;">লগইন করুন</a>
        </div>

        <div id="logged-in-content">
            <p class="info-text" style="text-align:center; font-weight:600;">লগইন করা আছেন: <span id="user-email">...</span></p>

            <!-- Delete Data Only -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-database"></i></div>
                    <h2 class="section-title">শুধু ডাটা ডিলিট করুন</h2>
                </div>
                <p>আপনার অর্ডার, পেমেন্ট ইত্যাদি সকল ডাটা মুছে যাবে — অ্যাকাউন্ট থাকবে।</p>
                <div class="warning-box">
                    <h3>সতর্কতা!</h3>
                    <p>এটি পুনরুদ্ধার করা যাবে না।</p>
                </div>
                <button onclick="deleteUserData()" class="delete-btn">ডাটা ডিলিট করুন</button>
            </div>

            <!-- Delete Full Account -->
            <div class="section-card">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-user-times"></i></div>
                    <h2 class="section-title">সম্পূর্ণ অ্যাকাউন্ট ডিলিট করুন</h2>
                </div>
                <p>অ্যাকাউন্ট এবং সব ডাটা চিরতরে মুছে যাবে।</p>
                <div class="warning-box">
                    <h3>সতর্কতা!</h3>
                    <p>এটি পুনরুদ্ধারযোগ্য নয়।</p>
                </div>
                <button onclick="deleteAccount()" class="delete-btn">অ্যাকাউন্ট ডিলিট করুন</button>
            </div>
        </div>
    </main>

</body>
</html>
