<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">               
    <title>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø</title>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        html, body { background: #000 !important; margin: 0; padding: 0; width: 100%; height: 100%; color: #fff; font-family: 'Courier New', monospace; }
        .content-wrapper { width: 100%; padding: 20px; padding-bottom: 100px; box-sizing: border-box; }
        .d-value { background: #111; border: 1px solid #333; border-radius: 8px; padding: 20px; line-height: 1.8; font-size: 18px; white-space: pre-line; word-break: break-word; }
        .pay-now-btn { position: fixed; bottom: 0; left: 0; width: 100%; background: linear-gradient(135deg, #fb00ff, #ff2222); color: white; border: none; padding: 20px; font-size: 20px; font-weight: bold; cursor: pointer; z-index: 1000; padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px)); }
        .pay-now-btn.hidden { display: none; }
        .error { color: #ff6666; padding: 20px; text-align: center; background: #111; border: 1px solid #ff2222; border-radius: 8px; }
        .loading { text-align: center; padding: 40px; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <script>
        // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        const firebaseConfig = {
            apiKey: "AIzaSyBt9t6mcjUtXxX2igAJdseuIIc8pP_QPEw",
            authDomain: "easy-premium.firebaseapp.com",
            databaseURL: "https://easy-premium-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "easy-premium",
            storageBucket: "easy-premium.firebasestorage.app",
            messagingSenderId: "155891252265",
            appId: "1:155891252265:web:77ab41de24231e8e5ef038"
        };

        // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ========== ‡¶∏‡¶†‡¶ø‡¶ï ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ==========
        function decryptData(encryptedData) {
            try {
                console.log("‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá:", encryptedData);
                
                // ‡¶∏‡ßç‡¶ü‡ßá‡¶™ 1: URL ‡¶°‡¶ø‡¶ï‡ßã‡¶° (‡¶•‡ßá‡¶ï‡ßá %2F ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)
                const urlDecoded = decodeURIComponent(encryptedData);
                console.log("URL ‡¶°‡¶ø‡¶ï‡ßã‡¶°:", urlDecoded);
                
                // ‡¶∏‡ßç‡¶ü‡ßá‡¶™ 2: Base64 ‡¶°‡¶ø‡¶ï‡ßã‡¶°
                // 'RVAtMTc3...' ‡¶•‡ßá‡¶ï‡ßá 'EP-177...' ‡¶π‡¶¨‡ßá
                const base64Decoded = atob(urlDecoded);
                console.log("Base64 ‡¶°‡¶ø‡¶ï‡ßã‡¶°:", base64Decoded);
                
                // ‡¶∏‡ßç‡¶ü‡ßá‡¶™ 3: XOR ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶® (‡¶è‡¶ï‡¶á ‡¶ï‡ßÄ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá)
                const key = 'EP_SECURE_2025_KEY_!@#';
                let decrypted = '';
                
                for (let i = 0; i < base64Decoded.length; i++) {
                    const keyChar = key.charCodeAt(i % key.length);
                    const dataChar = base64Decoded.charCodeAt(i);
                    decrypted += String.fromCharCode(dataChar ^ keyChar);
                }
                
                console.log("XOR ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶°:", decrypted);
                
                // ‡¶∏‡ßç‡¶ü‡ßá‡¶™ 4: ‡¶™‡¶æ‡¶á‡¶™ ‡¶∏‡ßá‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡ßá‡¶° ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏
                const parts = decrypted.split('|');
                
                if (parts.length >= 4) {
                    return {
                        orderId: parts[0],
                        platformId: parts[1],
                        price: parts[2],
                        timestamp: parts[3]
                    };
                } else {
                    console.error("‡¶™‡¶æ‡¶á‡¶™ ‡¶∏‡ßá‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø");
                    return null;
                }
            } catch (error) {
                console.error("‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶è‡¶∞‡¶∞:", error);
                return null;
            }
        }

        // ========== ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶∞‡¶æ ==========
        function formatPlatformName(platformId) {
            if (!platformId) return 'N/A';
            return platformId.replace(/_/g, ' ').toUpperCase();
        }

        // ========== ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡¶°‡¶º‡¶æ ==========
        async function fetchDFromFirebase(platformId) {
            try {
                const snapshot = await database.ref(`publicData/pricingPlans/${platformId}`).once('value');
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    return data.D || data.description || JSON.stringify(data);
                }
                return null;
            } catch (error) {
                console.error("Firebase error:", error);
                return null;
            }
        }

        // ========== ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶∞ ==========
        window.addEventListener('DOMContentLoaded', async function() {
            const outputDiv = document.getElementById('output');
            const payNowBtn = document.getElementById('payNowBtn');
            
            // URL ‡¶•‡ßá‡¶ï‡ßá data ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');
            
            if (!encodedData) {
                outputDiv.innerHTML = '<div class="error">‚ùå URL-‡¶è ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</div>';
                return;
            }
            
            // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
            const data = decryptData(encodedData);
            
            if (!data) {
                outputDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</strong><br><br>
                        <small>‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶° ‡¶°‡¶æ‡¶ü‡¶æ: ${encodedData.substring(0, 60)}...</small>
                    </div>
                `;
                return;
            }
            
            // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶®‡¶æ
            let dField = '';
            if (data.platformId) {
                const firebaseData = await fetchDFromFirebase(data.platformId);
                if (firebaseData) {
                    dField = `\n\nüìÑ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§:\n${firebaseData}`;
                }
            }
            
            // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶™ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ï‡¶∞‡¶æ
            const date = new Date(parseInt(data.timestamp));
            const formattedDate = date.toLocaleString('bn-BD', {
                year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
            
            // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            outputDiv.innerHTML = `
                <div class="d-value">
                    <strong>üìã ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</strong><br><br>
                    üîñ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${data.orderId}<br>
                    üéØ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ: ${formatPlatformName(data.platformId)}<br>
                    üí∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ${data.price} ‡ß≥<br>
                    üìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${formattedDate}${dField.replace(/\n/g, '<br>')}
                </div>
            `;
            
            // ‡¶™‡ßá ‡¶®‡¶æ‡¶ì ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            payNowBtn.classList.remove('hidden');
            payNowBtn.onclick = () => {
                alert(`‚úÖ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...\n\n‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞: ${data.orderId}\n‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ: ${formatPlatformName(data.platformId)}\n‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ${data.price} ‡ß≥`);
                // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ó‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®
                // window.location.href = `https://your-payment-gateway.com?order=${data.orderId}&amount=${data.price}`;
            };
        });
    </script>
</head>
<body>
    <div class="content-wrapper">
        <div id="output">
            <div class="loading">üîÑ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>
    </div>

    <button id="payNowBtn" class="pay-now-btn hidden">üí≥ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</body>
</html>
