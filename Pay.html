<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Premium - অর্ডার ডিটেইলস</title>
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            background: linear-gradient(135deg, #0a0a1a, #121230, #1a1a3a);
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        .header {
            background: rgba(10,10,26,0.95);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #ff9800;
        }
        .logo {
            color: #ff9800;
            font-size: 28px;
            font-weight: bold;
        }
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
        }
        .login-box {
            background: rgba(20,20,40,0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,152,0,0.3);
        }
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.3);
            border: 1px solid #ff9800;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        .login-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        .order-box {
            background: rgba(20,20,40,0.95);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(255,152,0,0.4);
            display: none;
        }
        .order-id {
            color: #ff9800;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
        }
        .platform-name {
            color: #4caf50;
            font-size: 22px;
            text-align: center;
            margin-bottom: 25px;
        }
        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        .detail-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .detail-label {
            color: #b0bec5;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .detail-value {
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        .description-box {
            background: rgba(0,0,0,0.3);
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            border-left: 4px solid #ff9800;
            max-height: 400px;
            overflow-y: auto;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
        }
        .btn-confirm {
            background: #4caf50;
            color: white;
        }
        .btn-cancel {
            background: #ff5252;
            color: white;
        }
        .btn-download {
            background: #2196f3;
            color: white;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #ff9800;
        }
        .error {
            background: rgba(255,82,82,0.15);
            color: #ff5252;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #ff5252;
        }
        footer {
            text-align: center;
            padding: 30px;
            color: #b0bec5;
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        @media (max-width: 768px) {
            .details-grid { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="fas fa-crown"></i> Easy Premium
        </div>
    </div>

    <div class="container">
        <!-- লগিন সিস্টেম -->
        <div class="login-box" id="loginSection">
            <h2 style="color: #ff9800; margin-bottom: 30px;">অর্ডার ডিটেইলস এক্সেস</h2>
            <input type="text" id="userId" class="login-input" placeholder="আপনার ইউজার আইডি (যেমন: FhHXrKhfDAWzwbM7N8NaduCmChn2)">
            <input type="text" id="orderId" class="login-input" placeholder="আপনার অর্ডার আইডি (যেমন: -01b3H8aB_NDCcMLyux)">
            <button class="login-btn" onclick="loginToOrder()">
                <i class="fas fa-lock"></i> অর্ডার এক্সেস করুন
            </button>
            <p style="margin-top: 20px; color: #b0bec5; font-size: 14px;">
                <i class="fas fa-info-circle"></i> শুধুমাত্র অর্ডার করার ইউজারই অর্ডারটি দেখতে পারবেন
            </p>
        </div>

        <!-- লোডিং -->
        <div class="loading" id="loadingSection" style="display:none;">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p style="margin-top: 20px;">অর্ডার লোড হচ্ছে...</p>
        </div>

        <!-- এরর মেসেজ -->
        <div class="error" id="errorSection" style="display:none;"></div>

        <!-- অর্ডার ডিটেইলস -->
        <div class="order-box" id="orderSection">
            <div class="order-id" id="orderIdDisplay"></div>
            <div class="platform-name" id="platformNameDisplay"></div>
            
            <div class="details-grid">
                <div class="detail-item">
                    <div class="detail-label">অর্ডার আইডি</div>
                    <div class="detail-value" id="detailOrderId"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">প্ল্যাটফর্ম</div>
                    <div class="detail-value" id="detailPlatform"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">স্ট্যাটাস</div>
                    <div class="detail-value" id="detailStatus"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">মূল্য</div>
                    <div class="detail-value" id="detailPrice"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">অর্ডার তারিখ</div>
                    <div class="detail-value" id="detailDate"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ইউজার আইডি</div>
                    <div class="detail-value" id="detailUserId"></div>
                </div>
            </div>

            <!-- প্ল্যাটফর্ম ডেসক্রিপশন -->
            <h3 style="color: #ff9800; margin-bottom: 15px;">
                <i class="fas fa-file-alt"></i> প্ল্যাটফর্ম ডেসক্রিপশন
            </h3>
            <div class="description-box" id="platformDescription"></div>

            <!-- ক্রেডেনশিয়ালস (যদি থাকে) -->
            <div id="credentialsSection" style="display:none; margin-top: 25px;">
                <h3 style="color: #4caf50; margin-bottom: 15px;">
                    <i class="fas fa-key"></i> অ্যাক্সেস ক্রেডেনশিয়ালস
                </h3>
                <div class="description-box" id="credentialsContent"></div>
            </div>

            <!-- ইউজার অ্যাকশনস -->
            <h3 style="color: #ff9800; margin-top: 30px; margin-bottom: 15px;">
                <i class="fas fa-tools"></i> অ্যাকশনস
            </h3>
            <div class="action-buttons">
                <button class="btn btn-confirm" onclick="confirmOrder()">
                    <i class="fas fa-check-circle"></i> কনফার্ম করুন
                </button>
                <button class="btn btn-download" onclick="downloadDetails()">
                    <i class="fas fa-download"></i> ডাউনলোড
                </button>
                <button class="btn btn-cancel" onclick="cancelOrder()">
                    <i class="fas fa-times-circle"></i> ক্যান্সেল
                </button>
            </div>
        </div>
    </div>

    <footer>
        © ২০২৬ Easy Premium | শুধুমাত্র অর্ডারকারী ইউজারের জন্য | সাপোর্ট: +8801770584994
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            databaseURL: "https://easy-premium-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Firebase Initialize
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let currentUserId = '';
        let currentOrderId = '';

        async function loginToOrder() {
            const userId = document.getElementById('userId').value.trim();
            const orderId = document.getElementById('orderId').value.trim();

            if (!userId || !orderId) {
                showError('ইউজার আইডি এবং অর্ডার আইডি দিতে হবে');
                return;
            }

            currentUserId = userId;
            currentOrderId = orderId;

            // UI আপডেট
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('errorSection').style.display = 'none';

            try {
                // Firebase থেকে ইউজারের অর্ডার চেক করুন
                const userOrdersRef = db.ref(`userOrders/${userId}/${orderId}`);
                const snapshot = await userOrdersRef.once('value');

                if (!snapshot.exists()) {
                    throw new Error('এই ইউজারের জন্য অর্ডার পাওয়া যায়নি');
                }

                const orderData = snapshot.val();
                console.log('✅ অর্ডার ডেটা:', orderData);

                // প্ল্যাটফর্ম আইডি পেতে
                const platformId = orderData.platformId || orderData.platform;
                if (!platformId) {
                    throw new Error('অর্ডারে প্ল্যাটফর্ম আইডি নেই');
                }

                // প্ল্যাটফর্ম ডেটা লোড করুন
                const platformRef = db.ref(`publicData/pricingPlans/${platformId}`);
                const platformSnap = await platformRef.once('value');

                if (!platformSnap.exists()) {
                    throw new Error('প্ল্যাটফর্ম ডেটা পাওয়া যায়নি');
                }

                const platformData = platformSnap.val();

                // সব ডেটা শো করুন
                displayOrderData(userId, orderId, orderData, platformData);

            } catch (error) {
                console.error('❌ Error:', error);
                showError(error.message);
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('loginSection').style.display = 'block';
            }
        }

        function displayOrderData(userId, orderId, orderData, platformData) {
            // UI শো করুন
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('orderSection').style.display = 'block';

            // 1. অর্ডার আইডি
            document.getElementById('orderIdDisplay').textContent = `অর্ডার #${orderId}`;
            document.getElementById('detailOrderId').textContent = orderId;

            // 2. প্ল্যাটফর্ম নাম
            const platformName = orderData.platform || platformData.name || 'Unknown';
            document.getElementById('platformNameDisplay').textContent = platformName;
            document.getElementById('detailPlatform').textContent = platformName;

            // 3. স্ট্যাটাস
            const status = orderData.status || 'pending';
            document.getElementById('detailStatus').textContent = status;

            // 4. মূল্য
            const price = orderData.price || platformData.price || 'N/A';
            document.getElementById('detailPrice').textContent = `৳${price}`;

            // 5. তারিখ
            const orderDate = orderData.orderDate || orderData.date || new Date().toISOString();
            document.getElementById('detailDate').textContent = formatDate(orderDate);

            // 6. ইউজার আইডি
            document.getElementById('detailUserId').textContent = userId;

            // 7. D ফিল্ড ডেসক্রিপশন
            let description = '';
            if (platformData.D) {
                description = platformData.D;
            } else if (platformData.description) {
                description = platformData.description;
            } else if (platformData.desc) {
                description = platformData.desc;
            } else {
                description = 'কোনো ডেসক্রিপশন নেই';
            }
            document.getElementById('platformDescription').textContent = description;

            // 8. ক্রেডেনশিয়ালস (যদি থাকে)
            if (orderData.credentials || orderData.username || orderData.password) {
                let credentials = '';
                if (orderData.credentials) {
                    credentials = orderData.credentials;
                } else {
                    credentials = `Username: ${orderData.username || 'N/A'}\n`;
                    credentials += `Password: ${orderData.password || 'N/A'}`;
                }
                document.getElementById('credentialsContent').textContent = credentials;
                document.getElementById('credentialsSection').style.display = 'block';
            }

            // 9. পেজ টাইটেল
            document.title = `${platformName} - অর্ডার #${orderId}`;
        }

        function confirmOrder() {
            if (confirm('আপনি কি এই অর্ডারটি কনফার্ম করতে চান?')) {
                // Firebase-এ স্ট্যাটাস আপডেট করুন
                const updateRef = db.ref(`userOrders/${currentUserId}/${currentOrderId}/status`);
                updateRef.set('confirmed')
                    .then(() => {
                        alert('✅ অর্ডার সফলভাবে কনফার্ম করা হয়েছে!');
                        document.getElementById('detailStatus').textContent = 'confirmed';
                        document.getElementById('detailStatus').style.color = '#4caf50';
                    })
                    .catch(error => {
                        alert('❌ কনফার্ম করতে সমস্যা: ' + error.message);
                    });
            }
        }

        function cancelOrder() {
            if (confirm('আপনি কি এই অর্ডারটি ক্যান্সেল করতে চান?')) {
                const updateRef = db.ref(`userOrders/${currentUserId}/${currentOrderId}/status`);
                updateRef.set('cancelled')
                    .then(() => {
                        alert('✅ অর্ডার ক্যান্সেল করা হয়েছে!');
                        document.getElementById('detailStatus').textContent = 'cancelled';
                        document.getElementById('detailStatus').style.color = '#ff5252';
                    })
                    .catch(error => {
                        alert('❌ ক্যান্সেল করতে সমস্যা: ' + error.message);
                    });
            }
        }

        function downloadDetails() {
            const orderContent = `
অর্ডার ডিটেইলস - Easy Premium
=============================
অর্ডার আইডি: ${currentOrderId}
ইউজার আইডি: ${currentUserId}
প্ল্যাটফর্ম: ${document.getElementById('detailPlatform').textContent}
স্ট্যাটাস: ${document.getElementById('detailStatus').textContent}
মূল্য: ${document.getElementById('detailPrice').textContent}
তারিখ: ${document.getElementById('detailDate').textContent}

ডেসক্রিপশন:
${document.getElementById('platformDescription').textContent}

© ২০২৬ Easy Premium
            `;

            const blob = new Blob([orderContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `order-${currentOrderId}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('bn-BD', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorSection');
            errorDiv.innerHTML = `
                <h3><i class="fas fa-exclamation-triangle"></i> সমস্যা হয়েছে</h3>
                <p>${message}</p>
                <button onclick="location.reload()" style="
                    background: #ff9800;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    margin-top: 15px;
                    cursor: pointer;
                ">
                    <i class="fas fa-redo"></i> আবার চেষ্টা করুন
                </button>
            `;
            errorDiv.style.display = 'block';
        }

        // URL-এ যদি অর্ডার আইডি থাকে, অটোফিল করুন
        const urlParams = new URLSearchParams(window.location.search);
        const orderIdFromUrl = urlParams.get('orderId');
        if (orderIdFromUrl) {
            document.getElementById('orderId').value = orderIdFromUrl;
        }
    </script>
</body>
</html>
