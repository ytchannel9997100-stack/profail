<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Premium - Order Details</title>
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            background: linear-gradient(135deg, #0a0a1a, #121230, #1a1a3a);
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(20,20,40,0.9);
            border-radius: 10px;
            padding: 30px;
            border: 1px solid rgba(255,152,0,0.3);
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
        .error {
            color: #ff5252;
            text-align: center;
            padding: 30px;
            border: 1px solid #ff5252;
            border-radius: 10px;
            margin: 20px 0;
        }
        .order-details {
            display: none;
        }
        .description-box {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .description-box::-webkit-scrollbar {
            width: 8px;
        }
        .description-box::-webkit-scrollbar-thumb {
            background: #ff9800;
            border-radius: 4px;
        }
        .order-id {
            color: #ff9800;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .debug-info {
            background: rgba(255,152,0,0.1);
            border: 1px solid rgba(255,152,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            font-family: monospace;
        }
        footer {
            text-align: center;
            margin-top: 30px;
            color: #b0bec5;
            font-size: 14px;
        }
        button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #f57c00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="error" id="error" style="display:none;"></div>
        
        <div class="order-details" id="orderDetails">
            <div class="order-id" id="orderIdDisplay"></div>
            <div class="description-box" id="orderDescription"></div>
            <div class="debug-info" id="debugInfo" style="display:none;"></div>
        </div>
    </div>

    <footer>
        ¬© ‡ß®‡ß¶‡ß®‡ß¨ Easy Premium | ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü: +8801770584994
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            databaseURL: "https://easy-premium-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Get orderId from URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');

        if (!orderId) {
            showError('‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ URL-‡¶è ?orderId=YOUR_ID ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
        } else {
            loadAllData(orderId);
        }

        function loadAllData(orderId) {
            console.log("üîç Order ID:", orderId);
            
            // Firebase-‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶®‡ßã‡¶° ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡¶¨‡ßá
            searchInAllNodes(orderId);
        }

        function searchInAllNodes(orderId) {
            const allRef = db.ref('/');
            
            allRef.once('value')
                .then((snapshot) => {
                    const allData = snapshot.val();
                    console.log("üì¶ All Firebase data:", allData);
                    
                    // ‡¶∏‡¶¨ ‡¶®‡ßã‡¶°‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßã
                    let foundData = null;
                    let foundPath = "";
                    
                    function searchRecursive(data, path = "") {
                        for (const key in data) {
                            const currentPath = path ? `${path}/${key}` : key;
                            const value = data[key];
                            
                            // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø orderId match ‡¶ï‡¶∞‡ßá
                            if (key === orderId) {
                                foundData = value;
                                foundPath = currentPath;
                                console.log("‚úÖ Found at path:", currentPath, value);
                                return true;
                            }
                            
                            // ‡¶Ø‡¶¶‡¶ø D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶•‡¶æ‡¶ï‡ßá
                            if (value && typeof value === 'object' && value.D) {
                                console.log("üìÑ Found D field at:", currentPath, value.D.substring(0, 50) + "...");
                            }
                            
                            // Recursive search
                            if (value && typeof value === 'object') {
                                if (searchRecursive(value, currentPath)) {
                                    return true;
                                }
                            }
                        }
                        return false;
                    }
                    
                    if (allData && searchRecursive(allData)) {
                        showOrderDetails(foundData, orderId, foundPath);
                    } else {
                        // ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶æ ‡¶™‡¶æ‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ orderId ‡¶®‡ßã‡¶°‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßã
                        db.ref(orderId).once('value')
                            .then((snap) => {
                                if (snap.exists()) {
                                    showOrderDetails(snap.val(), orderId, orderId);
                                } else {
                                    showError('‡¶è‡¶á ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø Firebase-‡¶è ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§');
                                    showDebugInfo(allData);
                                }
                            })
                            .catch(err => {
                                console.error("Error:", err);
                                showError('Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + err.message);
                            });
                    }
                })
                .catch((error) => {
                    console.error("Firebase error:", error);
                    showError('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                });
        }

        function showOrderDetails(data, orderId, path) {
            console.log("üéØ Order Data found:", data);
            
            document.getElementById('loading').style.display = 'none';
            
            // Order ID show
            document.getElementById('orderIdDisplay').textContent = `‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ID: ${orderId} (‡¶™‡¶æ‡¶•: ${path})`;
            
            // D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ
            let description = "";
            
            if (data.D) {
                description = data.D;
                console.log("‚úÖ D field found:", description.substring(0, 100) + "...");
            } else {
                // D ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßã
                const possibleFields = ['description', 'desc', 'details', 'Details', 'info', 'text', 'content'];
                for (const field of possibleFields) {
                    if (data[field]) {
                        description = data[field];
                        console.log(`üìù Using ${field} field:`, description.substring(0, 100) + "...");
                        break;
                    }
                }
                
                if (!description) {
                    description = "‚ùå D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶§‡¶•‡ßç‡¶Ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®:\n\n" + 
                                 JSON.stringify(data, null, 2);
                }
            }
            
            document.getElementById('orderDescription').textContent = description;
            
            // ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶§‡¶•‡ßç‡¶Ø
            let debugText = `üìä Firebase ‡¶™‡¶æ‡¶•: ${path}\n`;
            debugText += `üîë ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡¶∏‡¶Æ‡ßÇ‡¶π: ${Object.keys(data).join(', ')}\n`;
            debugText += `üì¶ D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶õ‡ßá: ${data.D ? '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å' : '‡¶®‡¶æ'}\n`;
            debugText += `üéØ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶°‡ßá‡¶ü‡¶æ:\n${JSON.stringify(data, null, 2)}`;
            
            document.getElementById('debugInfo').textContent = debugText;
            document.getElementById('debugInfo').style.display = 'block';
            
            // Show the details
            document.getElementById('orderDetails').style.display = 'block';
            
            // Update page title
            document.title = `Order ${orderId} - Easy Premium`;
        }

        function showDebugInfo(allData) {
            let debugText = "üî• Firebase-‡¶è ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶∏‡¶ï‡¶≤ ‡¶Æ‡ßÇ‡¶≤ ‡¶®‡ßã‡¶°:\n\n";
            
            if (allData) {
                const rootKeys = Object.keys(allData);
                debugText += `üìÅ ‡¶∞‡ßÅ‡¶ü ‡¶®‡ßã‡¶° (${rootKeys.length}‡¶ü‡¶ø): ${rootKeys.join(', ')}\n\n`;
                
                // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶Æ‡ßÇ‡¶≤ ‡¶®‡ßã‡¶°‡ßá‡¶∞ keys ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
                for (const key of rootKeys) {
                    if (allData[key] && typeof allData[key] === 'object') {
                        const subKeys = Object.keys(allData[key]);
                        debugText += `üìÇ ${key}: ${subKeys.length > 10 ? subKeys.slice(0, 10).join(', ') + '...' : subKeys.join(', ')}\n`;
                    }
                }
                
                // D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶õ‡ßá ‡¶è‡¶Æ‡¶® ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶ñ‡ßã‡¶Å‡¶ú‡ßã
                debugText += "\nüîç D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶õ‡ßá ‡¶è‡¶Æ‡¶® ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ:\n";
                let dCount = 0;
                
                function findDFields(obj, path = "", depth = 0) {
                    if (depth > 3) return; // Limit depth
                    
                    for (const key in obj) {
                        const value = obj[key];
                        const currentPath = path ? `${path}/${key}` : key;
                        
                        if (value && typeof value === 'object') {
                            if (value.D) {
                                debugText += `üìç ${currentPath}: ${value.D.substring(0, 50)}...\n`;
                                dCount++;
                            }
                            findDFields(value, currentPath, depth + 1);
                        }
                    }
                }
                
                findDFields(allData);
                
                if (dCount === 0) {
                    debugText += "‚ùå ‡¶ï‡ßã‡¶®‡ßã D ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!\n";
                }
            }
            
            document.getElementById('debugInfo').textContent = debugText;
            document.getElementById('debugInfo').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
            
            // ‡¶∞‡¶ø‡¶ü‡ßç‡¶∞‡¶æ‡¶á ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßã
            const retryBtn = document.createElement('button');
            retryBtn.textContent = '‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            retryBtn.onclick = function() {
                location.reload();
            };
            errorDiv.appendChild(document.createElement('br'));
            errorDiv.appendChild(retryBtn);
        }
    </script>
</body>
</html>
